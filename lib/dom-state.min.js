"use strict";function _classCallCheck(e,t){if(!_instanceof(e,t))throw new TypeError("Cannot call a class as a function")}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _instanceof(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}var DomState=function(){var p={root:{element:null,elementId:"dom-state-root-element",compiledComponent:null},store:{},factories:{},components:{}},l={render:function(){p.root.compiledComponent(p.store)},createElement:function(e,a){var t=document.createElement("DIV");return t.innerHTML=e.trim(),(t=t.firstChild).parentElement.removeChild(t),function e(t){for(var o=0;o<t.childNodes.length;o++){var n=t.childNodes[o];switch(n.nodeType){case Node.ELEMENT_NODE:if(0<n.attributes.length){p.components[n.tagName]&&(n._domStateProps={});for(var r=0;r<n.attributes.length;r++){var c=n.attributes[r].name.replace(/-([a-z])/g,function(e){return e[1].toUpperCase()});p.components[n.tagName]&&(n._domStateProps[c]=n.attributes[r].value);var i=n.attributes[r].nodeValue.match(/{{(.*?)}}/gm);i&&0<i.length&&(i=i[0].replace(/{{|}}/gm,""),p.components[n.tagName]?n._domStateProps[c]=i.split(".").reduce(function(e,t){return e&&e[t]?e[t]:null},a):n.attributes[r].name.startsWith("on")&&(n.addEventListener(n.attributes[r].name.substr(2),i.split(".").reduce(function(e,t){return e&&e[t]?e[t]:null},a)),n.removeAttribute(n.attributes[r].name)))}}n.children&&e(n)}}}({childNodes:[t]}),t},createComponent:function(e){Array.isArray(e)||(e=[e]);for(var t=0,o=[void 0],t=0;t<e.length;t++){if(!(t+1<e.length)){var n=new(e[t].bind.apply(e[t],o));return n.component={render:l.render,createElement:l.createElement},n.store={},n.props={},n}o.push(p.factories[e[t]])}},compile:function(i,a){var s=[];!function e(t){for(var o=0;o<t.childNodes.length;o++){var n=t.childNodes[o];switch(n.nodeType){case Node.ELEMENT_NODE:if(p.components[n.tagName]){var r=n.tagName+(n.attributes.key?"|"+n._domStateProps.key:""),c={name:r,props:n._domStateProps,node:n,compiled:null,prevState:{store:void 0,props:void 0},component:null};if(delete n._domStateProps,a)for(var i in a)a[i].name==r&&(n.parentNode&&n.parentNode.replaceChild(a[i].node,n),c.node=a[i].node,c.compiled=a[i].compiled,c.prevState=a[i].prevState,c.component=a[i].component);null===c.component&&(c.component=l.createComponent(p.components[n.tagName])),s.push(c)}else n.children&&e(n)}}}({childNodes:[i]});function e(e){var t,o;for(var n in s)switch((t=s[n]).node.nodeType){case Node.ELEMENT_NODE:t.component.store=e,t.component.props=t.props;var r,c=!0;(t.component.watchStore||t.component.props)&&(r=[],t.component.watchStore&&(r=r.concat(t.component.watchStore.map(function(e){return"store."+e}))),t.props&&(r=r.concat(Object.keys(t.props).map(function(e){return"props."+e}))),c=l.deepCompare(r,{store:p.store,props:t.props},t.prevState)),t.compiled&&c||(t.compiled=l.compile(t.component.render(),t.compiled?t.compiled.watchNodes:void 0)),null==(o=t.compiled(e)).parentNode&&(t.node.parentNode&&t.node.parentNode.replaceChild(o,t.node),t.node=o)}return i}return e.watchNodes=s,e},deepCompare:function(e,t,o){var c,i,n={};for(var r in e)e[r].split(".").reduce(function(e,t){return(e=e||{})[t]||(e[t]={}),e[t]},n);return i=c=[],!!function e(t,o,n){var r;if(isNaN(o)&&isNaN(n)&&"number"==typeof o&&"number"==typeof n)return 1;if(o===n)return 1;if("function"==typeof o&&"function"==typeof n||_instanceof(o,Date)&&_instanceof(n,Date)||_instanceof(o,RegExp)&&_instanceof(n,RegExp)||_instanceof(o,String)&&_instanceof(n,String)||_instanceof(o,Number)&&_instanceof(n,Number))return o.toString()===n.toString();if(_instanceof(o,Object)&&_instanceof(n,Object)&&!o.isPrototypeOf(n)&&!n.isPrototypeOf(o)&&o.constructor===n.constructor&&o.prototype===n.prototype&&!(-1<c.indexOf(o)||-1<i.indexOf(n))){for(r in n){if(t){if(!t.hasOwnProperty(r))continue;0<Object.keys(t[r]).length&&!o.hasOwnProperty(r)&&(o[r]="object"===_typeof(n[r])?JSON.parse(JSON.stringify(n[r])):n[r])}if(n.hasOwnProperty(r)!==o.hasOwnProperty(r))return;if(_typeof(n[r])!==_typeof(o[r]))return}for(r in o){if(t){if(!t.hasOwnProperty(r))continue;0<Object.keys(t[r]).length&&!n.hasOwnProperty(r)&&(n[r]="object"===_typeof(o[r])?JSON.parse(JSON.stringify(o[r])):o[r])}if(n.hasOwnProperty(r)!==o.hasOwnProperty(r))return;if(_typeof(n[r])!==_typeof(o[r]))return;switch(_typeof(o[r])){case"object":case"function":if(c.push(o),i.push(n),!e(t&&t.hasOwnProperty(r)&&0!==Object.keys(t[r]).length?t[r]:null,o[r],n[r]))return;c.pop(),i.pop();break;default:if(o[r]!==n[r])return}}return 1}}(0===Object.keys(n).length?null:n,t,o)||(0!==Object.keys(n).length&&function t(o,n,r){n=n||{},r=r||{},Object.keys(r).forEach(function(e){delete r[e]}),Object.keys(o).forEach(function(e){r[e]="object"===_typeof(n[e])?JSON.parse(JSON.stringify(n[e])):n[e],0!==Object.keys(o[e]).length&&t(o[e],n[e],r[e])})}(n,t,o),!1)}};return function e(){_classCallCheck(this,e),this.store=p.store,this.setStore=function(e){this.store=p.store=e,l.render()},this.settings=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;"object"===_typeof(t)&&null!==t&&(this.store=p.store=t),e&&e.rootElementId&&(p.root.elementId=e.rootElementId)},this.addComponent=function(e,t){p.components[e.toUpperCase()]=t},this.addFactory=function(e,t){p.factories[e]=t},this.run=function(){p.root.element=document.getElementById(p.root.elementId),p.root.compiledComponent=l.compile(p.root.element),l.render()}}}();
//# sourceMappingURL=dom-state.min.js.map